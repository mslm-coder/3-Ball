<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGA Tour 3-Ball Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a4d0a 0%, #1a5c1a 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            color: #0a4d0a;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tournament-info {
            color: #666;
            font-size: 1.1em;
        }

        .tournament-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .data-source {
            display: inline-block;
            margin-top: 10px;
            padding: 6px 12px;
            background: #e8f5e9;
            color: #2e7d32;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #0a4d0a;
        }

        .refresh-btn {
            padding: 12px 24px;
            background: #0a4d0a;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .refresh-btn:hover {
            background: #1a5c1a;
        }

        .refresh-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .last-update {
            color: #666;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 12px;
            color: #666;
            font-size: 1.2em;
        }

        .error {
            background: #fff3cd;
            color: #856404;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #ffc107;
        }

        .threeball-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 20px;
        }

        .threeball-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .threeball-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }

        .card-header {
            background: #f5f5f5;
            padding: 16px 20px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tee-time {
            font-weight: 600;
            color: #0a4d0a;
            font-size: 1.1em;
        }

        .round-info {
            color: #666;
            font-size: 0.9em;
            margin-top: 4px;
        }

        .players-list {
            padding: 0;
        }

        .player-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s;
        }

        .player-row:last-child {
            border-bottom: none;
        }

        .player-row:hover {
            background: #fafafa;
        }

        .player-row.leader {
            background: #e8f5e9;
        }

        .player-row.leader:hover {
            background: #dcedc8;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 600;
            color: #333;
            font-size: 1.05em;
            margin-bottom: 4px;
        }

        .player-row.leader .player-name {
            color: #0a4d0a;
        }

        .player-position {
            color: #666;
            font-size: 0.85em;
        }

        .player-stats {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .score {
            font-size: 1.4em;
            font-weight: 700;
            min-width: 45px;
            text-align: right;
        }

        .score.under {
            color: #c62828;
        }

        .score.over {
            color: #2e7d32;
        }

        .score.even {
            color: #333;
        }

        .thru {
            color: #666;
            font-size: 0.9em;
            min-width: 40px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            background: #4caf50;
            color: white;
            margin-left: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            background: white;
            border-radius: 12px;
            color: #666;
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: #333;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8em;
            }

            .threeball-grid {
                grid-template-columns: 1fr;
            }

            .controls {
                flex-direction: column;
            }

            .search-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚õ≥ PGA Tour 3-Ball Tracker</h1>
            <div class="tournament-info">
                <div class="tournament-name" id="tournamentName">Loading...</div>
                <div id="roundInfo">Round 1</div>
                <div class="data-source" id="dataSource">üì° Connecting...</div>
            </div>
        </div>

        <div class="controls">
            <input
                type="text"
                class="search-input"
                id="searchInput"
                placeholder="Search for a player..."
            />
            <button class="refresh-btn" id="refreshBtn">
                üîÑ Refresh
            </button>
            <div class="last-update" id="lastUpdate"></div>
        </div>

        <div id="content">
            <div class="loading">
                üîÑ Loading PGA Tour data...
            </div>
        </div>
    </div>

    <script>
        let tournamentData = null;

        // Fetch data with multiple fallbacks
        async function fetchData() {
            // Try ESPN API
            try {
                console.log('Trying ESPN API...');
                const response = await fetch('https://site.api.espn.com/apis/site/v2/sports/golf/pga/leaderboard');
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.events && data.events.length > 0) {
                        return transformESPNData(data.events[0]);
                    }
                }
            } catch (err) {
                console.log('ESPN API failed:', err);
            }

            // Try PGA Tour API
            try {
                console.log('Trying PGA Tour API...');
                const scheduleRes = await fetch('https://statdata.pgatour.com/r/current/schedule-v2.json');
                
                if (scheduleRes.ok) {
                    const schedule = await scheduleRes.json();
                    const tournament = schedule.tournaments.find(t => 
                        t.tournStatus === 'In Progress' || t.tournStatus === 'Upcoming'
                    ) || schedule.tournaments[0];
                    
                    if (tournament) {
                        const pairingsRes = await fetch(`https://statdata.pgatour.com/r/${tournament.permNum}/pairings.json`);
                        if (pairingsRes.ok) {
                            const pairings = await pairingsRes.json();
                            return transformPGAData(tournament, pairings);
                        }
                    }
                }
            } catch (err) {
                console.log('PGA Tour API failed:', err);
            }

            // Fallback to sample data
            return getSampleData();
        }

        function transformESPNData(event) {
            const competition = event.competitions[0];
            const competitors = competition.competitors || [];
            
            const groupedByTime = {};
            
            competitors.forEach(comp => {
                const teeTime = comp.teeTime || '12:00 PM';
                if (!groupedByTime[teeTime]) {
                    groupedByTime[teeTime] = [];
                }
                
                const scoreValue = comp.score?.value || 0;
                const scoreNum = parseInt(scoreValue) || 0;
                
                groupedByTime[teeTime].push({
                    playerName: comp.athlete.displayName,
                    currentPosition: comp.status?.position?.displayValue || 'T1',
                    score: comp.score?.displayValue || 'E',
                    scoreNum: scoreNum,
                    thru: comp.status?.thru || 'F',
                    status: comp.status?.type?.name || 'active'
                });
            });
            
            const groups = [];
            Object.entries(groupedByTime).forEach(([teeTime, players]) => {
                for (let i = 0; i < players.length; i += 3) {
                    const group = players.slice(i, i + 3);
                    if (group.length > 0) {
                        groups.push({
                            teeTime: teeTime,
                            course: competition.venue?.fullName || 'Course',
                            players: group
                        });
                    }
                }
            });
            
            return {
                tournament: {
                    tournamentName: event.name,
                    currentRound: competition.status?.period || 1
                },
                groups: groups,
                dataSource: 'ESPN API'
            };
        }

        function transformPGAData(tournament, pairings) {
            const currentRound = pairings.rnds?.find(r => 
                r.roundNum === tournament.currentRound
            ) || pairings.rnds[0];
            
            const groups = currentRound.groups.map(g => ({
                teeTime: g.teeTime,
                course: g.course || 'Course',
                players: g.players.map(p => ({
                    playerName: p.playerName || `${p.firstName} ${p.lastName}`,
                    currentPosition: 'T1',
                    score: 'E',
                    scoreNum: 0,
                    thru: 'F',
                    status: 'active'
                }))
            }));
            
            return {
                tournament: {
                    tournamentName: tournament.tournamentName,
                    currentRound: tournament.currentRound
                },
                groups: groups,
                dataSource: 'PGA Tour API'
            };
        }

        function getSampleData() {
            return {
                tournament: {
                    tournamentName: 'WM Phoenix Open',
                    currentRound: '2'
                },
                groups: [
                    {
                        teeTime: '7:40 AM',
                        course: 'TPC Scottsdale (Stadium)',
                        players: [
                            {playerName: 'Scottie Scheffler', currentPosition: 'T1', score: '-12', scoreNum: -12, thru: '15'},
                            {playerName: 'Rory McIlroy', currentPosition: 'T3', score: '-10', scoreNum: -10, thru: '15'},
                            {playerName: 'Jordan Spieth', currentPosition: 'T8', score: '-7', scoreNum: -7, thru: '15'}
                        ]
                    },
                    {
                        teeTime: '7:51 AM',
                        course: 'TPC Scottsdale (Stadium)',
                        players: [
                            {playerName: 'Patrick Cantlay', currentPosition: 'T1', score: '-12', scoreNum: -12, thru: '14'},
                            {playerName: 'Xander Schauffele', currentPosition: 'T5', score: '-9', scoreNum: -9, thru: '14'},
                            {playerName: 'Viktor Hovland', currentPosition: 'T12', score: '-6', scoreNum: -6, thru: '14'}
                        ]
                    },
                    {
                        teeTime: '8:02 AM',
                        course: 'TPC Scottsdale (Stadium)',
                        players: [
                            {playerName: 'Jon Rahm', currentPosition: 'T3', score: '-10', scoreNum: -10, thru: '13'},
                            {playerName: 'Collin Morikawa', currentPosition: 'T8', score: '-7', scoreNum: -7, thru: '13'},
                            {playerName: 'Justin Thomas', currentPosition: 'T15', score: '-5', scoreNum: -5, thru: '13'}
                        ]
                    },
                    {
                        teeTime: '8:13 AM',
                        course: 'TPC Scottsdale (Stadium)',
                        players: [
                            {playerName: 'Max Homa', currentPosition: 'T5', score: '-9', scoreNum: -9, thru: '12'},
                            {playerName: 'Tony Finau', currentPosition: 'T12', score: '-6', scoreNum: -6, thru: '12'},
                            {playerName: 'Sam Burns', currentPosition: 'T20', score: '-4', scoreNum: -4, thru: '12'}
                        ]
                    }
                ],
                dataSource: 'Sample Data (APIs Unavailable)'
            };
        }

        async function loadData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.disabled = true;
            refreshBtn.textContent = 'üîÑ Loading...';
            
            try {
                tournamentData = await fetchData();
                updateUI();
                document.getElementById('lastUpdate').textContent = 
                    `Last updated: ${new Date().toLocaleTimeString()}`;
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('content').innerHTML = `
                    <div class="error">
                        <strong>‚ö†Ô∏è Error Loading Data</strong><br>
                        ${error.message}
                    </div>
                `;
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'üîÑ Refresh';
            }
        }

        function updateUI() {
            document.getElementById('tournamentName').textContent = 
                tournamentData.tournament.tournamentName;
            document.getElementById('roundInfo').textContent = 
                `Round ${tournamentData.tournament.currentRound}`;
            document.getElementById('dataSource').textContent = 
                `üì° ${tournamentData.dataSource}`;
            
            renderGroups(tournamentData.groups);
        }

        function renderGroups(groups) {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = groups;
            if (searchTerm) {
                filtered = groups.filter(g =>
                    g.players.some(p => p.playerName.toLowerCase().includes(searchTerm))
                );
            }
            
            const content = document.getElementById('content');
            
            if (filtered.length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h3>No matches found</h3>
                        <p>Try a different search term</p>
                    </div>
                `;
                return;
            }
            
            const grid = document.createElement('div');
            grid.className = 'threeball-grid';
            
            filtered.forEach(group => {
                const scores = group.players.map(p => p.scoreNum);
                const leadingScore = Math.min(...scores);
                
                const card = document.createElement('div');
                card.className = 'threeball-card';
                
                const playersHTML = group.players.map(p => {
                    const isLeading = p.scoreNum === leadingScore;
                    const scoreClass = p.scoreNum < 0 ? 'under' : p.scoreNum > 0 ? 'over' : 'even';
                    const formattedScore = p.scoreNum === 0 ? 'E' : p.scoreNum > 0 ? `+${p.scoreNum}` : p.scoreNum;
                    
                    return `
                        <div class="player-row ${isLeading ? 'leader' : ''}">
                            <div class="player-info">
                                <div class="player-name">
                                    ${p.playerName}
                                    ${isLeading ? '<span class="status-badge">Leading</span>' : ''}
                                </div>
                                <div class="player-position">${p.currentPosition}</div>
                            </div>
                            <div class="player-stats">
                                <div class="score ${scoreClass}">${formattedScore}</div>
                                <div class="thru">${p.thru === 'F' ? 'F' : p.thru + '*'}</div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="tee-time">üïê ${group.teeTime}</div>
                        <div class="round-info">${group.course}</div>
                    </div>
                    <div class="players-list">
                        ${playersHTML}
                    </div>
                `;
                
                grid.appendChild(card);
            });
            
            content.innerHTML = '';
            content.appendChild(grid);
        }

        // Event listeners
        document.getElementById('refreshBtn').addEventListener('click', loadData);
        document.getElementById('searchInput').addEventListener('input', () => {
            if (tournamentData) {
                renderGroups(tournamentData.groups);
            }
        });

        // Auto-refresh every 2 minutes
        setInterval(loadData, 120000);

        // Initial load
        loadData();
    </script>
</body>
</html>
